<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Admin Coin</title>
    <link rel="stylesheet" href="//stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
</head>

<body>
    <div class="container">
        <div class="row3">
            <div class="jumbotron">
                <h1 class="display-6">Set Password</h1>
                <p class="lead">Enter the password to use the erc20 wallet news manager. This password is used to send new news and read the administrator's notes.</p>
                <hr class="my-4">
                <form>
                    <div class="form-group">
                        <label for="title_es">Password</label>
                        <input type="text" class="form-control" style="width:100%" id="pwd" name="pwd" placeholder="Password" value="">
                    </div>
                </form>
            </div>
            <div class="jumbotron">
                <h1 class="display-6">Create News</h1>
                <p class="lead">This form is to create a new news, so you can notify all users about the news.</p>
                <hr class="my-4">
                <form onsubmit="return sendNews();">
                    <div class="form-group">
                        <label for="title_es">Title ES</label>
                        <input type="text" class="form-control" id="title_es" name="title_es" placeholder="title_es" required>
                    </div>
                    <div class="form-group">
                        <label for="title_en">Title EN</label>
                        <input type="text" class="form-control" id="title_en" name="title_en" placeholder="title_en" required>
                    </div>
                    <div class="form-group">
                        <label for="msg_es">MSG ES</label>
                        <textarea class="form-control" id="msg_es" name="msg_es" rows="3" placeholder="msg_es" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="msg_en">MSG EN</label>
                        <textarea class="form-control" id="msg_en" name="msg_en" rows="3" placeholder="msg_en" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="img">IMG</label>
                        <input type="text" class="form-control" id="img" name="img" placeholder="img">
                    </div>
                    <div class="form-group">
                        <label for="link">LINK</label>
                        <input type="text" class="form-control" id="link" name="link" placeholder="link">
                    </div>
                    <div class="form-group">
                        <label for="notify">Notify users</label>
                        <select class="form-control" id="notify" name="notify">
                            <option selected value="yes">Yes</option>
                            <option value="no">No</option>
                        </select>
                    </div>
                    <button type="submit" id="btn" class="btn btn-primary">Save</button>
                    <div class="progress" id="loading" style="display: none;">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
                    </div>
                </form>
            </div>
            <div class="jumbotron">
                <h1 class="display-6">News List</h1>
                <p class="lead">This is the list of news items that were previously sent to wallet users. <button onclick="readNews();" type="button" id="btn" class="btn btn-primary">Refresh</button></p>
                <hr class="my-4">
                <form>
                    <div class="form-group">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col">created_at</th>
                                    <th scope="col">title_en</th>
                                    <th scope="col">notify</th>
                                </tr>
                            </thead>
                            <tbody id="listnews"></tbody>
                        </table>
                    </div>
                </form>
            </div>
            <div class="jumbotron">
                <h1 class="display-6">Empty wallet</h1>
                <p class="lead">Emptying the wallet will erase all the records and start again. <button onclick="emptyWallet();" type="button" id="btn" class="btn btn-primary">Empty wallet</button></p>
            </div>
        </div>
        <div class="modal fade" id="myModal" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Info New</h4>
                    </div>
                    <div class="modal-body">
                        <p><strong>uuid : </strong><span id="tx_uuid">uuid</span></p>
                        <p><strong>title_es : </strong><span id="tx_title_es">title_es</span></p>
                        <p><strong>title_en : </strong><span id="tx_title_en">title_en</span></p>
                        <p><strong>msg_es : </strong><span id="tx_msg_es">msg_es</span></p>
                        <p><strong>msg_en : </strong><span id="tx_msg_en">msg_en</span></p>
                        <p><strong>link : </strong><span id="tx_link">link</span></p>
                        <p><strong>notify : </strong><span id="tx_notify">notify</span></p>
                        <p><strong>created_at : </strong><span id="tx_created_at">created_at</span></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="//code.jquery.com/jquery-3.4.1.slim.min.js"></script>
    <script src="//code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="//stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script>
        let news = {};

        function renderNews() {
            $("#listnews").html("");
            for (let k in news) {
                let d = news[k];
                let html = `
                    <tr onclick="getDetailsNews('` + d["uuid"] + `');">
                        <th scope="row">` + d["created_at"] + `</th>
                        <td>` + d["title_en"] + `</td>
                        <td>` + d["notify"] + `</td>
                    </tr>                
                `;
                $("#listnews").append(html);
            }
        }


        function getDetailsNews(uuid) {
            let d = news[uuid];
            $("#tx_uuid").html(d["uuid"]);
            $("#tx_title_es").html(d["title_es"]);
            $("#tx_title_en").html(d["title_en"]);
            $("#tx_msg_es").html(d["msg_es"]);
            $("#tx_msg_en").html(d["msg_en"]);
            $("#tx_img").html(d["img"]);
            $("#tx_link").html(d["link"]);
            $("#tx_status").html(d["status"]);
            $("#tx_notify").html(d["notify"]);
            $("#tx_created_at").html(d["created_at"]);
            $("#myModal").modal();
        }


        function sendNews() {
            let pwd = $("#pwd").val();
            let a = window.location.href.split("/");
            let last = a[(a.length - 1)];
            let url = window.location.href.replace(last, "new-news");
            $.ajax({
                async: false,
                dataType: "json",
                type: "POST",
                url: url,
                data: {
                    "pwd": pwd,
                    "title_es": $("#title_es").val(),
                    "title_en": $("#title_en").val(),
                    "msg_es": $("#msg_es").val(),
                    "msg_en": $("#msg_en").val(),
                    "img": $("#img").val(),
                    "link": $("#link").val(),
                    "notify": $("#notify").val(),
                },
                global: true,
                ifModified: false,
                processData: true,
                contentType: "application/x-www-form-urlencoded",
                success: function(datos) {
                    $("#title_es").val("");
                    $("#title_en").val("");
                    $("#msg_es").val("");
                    $("#msg_en").val("");
                    $("#img").val("");
                    $("#notify").val("yes");
                    $("#link").val("");
                    alert(datos.msg);
                    readNews();
                },
                error: function(jqXHR, exception) {
                    alert(jqXHR.responseJSON.msg);
                }
            });
            return false;
        }



        function readNews() {
            let pwd = $("#pwd").val();
            let a = window.location.href.split("/");
            let last = a[(a.length - 1)];
            let url = window.location.href.replace(last, "get-news");
            $.ajax({
                async: false,
                dataType: "json",
                type: "POST",
                url: url,
                data: {
                    "pwd": pwd
                },
                global: true,
                ifModified: false,
                processData: true,
                contentType: "application/x-www-form-urlencoded",
                success: function(datos) {
                    for (let k in datos["data"]) {
                        let d = datos["data"][k];
                        news[d["uuid"]] = d;
                    }
                    renderNews();
                },
                error: function(jqXHR, exception) {
                    news = {};
                    renderNews();
                    alert(jqXHR.responseJSON.msg);
                }
            });
        }

        function emptyWallet() {
            let __confirm = confirm('Are you sure you want to empty the wallet?');
            if (__confirm) {
                let pwd = $("#pwd").val();
                let a = window.location.href.split("/");
                let last = a[(a.length - 1)];
                let url = window.location.href.replace(last, "delete-wallet");
                $.ajax({
                    async: false,
                    dataType: "json",
                    type: "POST",
                    url: url,
                    data: {
                        "pwd": pwd
                    },
                    global: true,
                    ifModified: false,
                    processData: true,
                    contentType: "application/x-www-form-urlencoded",
                    success: function(datos) {
                        alert(datos.msg);
                        news = {};
                        renderNews();
                    },
                    error: function(jqXHR, exception) {
                        alert(jqXHR.responseJSON.msg);
                    }
                });
            }
        }
    </script>
</body>

</html>